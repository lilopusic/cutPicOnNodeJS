"use strict";!function(t){t.fn.cutPic=function(e){function i(t,e,i,o){et.style.display="none",tt.style.display="block",rt=i-t,dt=o-e;var h=(at.width-rt)/2,n=(at.height-dt)/2;wt.width=i-t,wt.height=o-e,wt.left=h,wt.top=n,wt.isHorizontal=!1,wt.isVertical=!1,wt.haveWaterMark=pt.haveWaterMark||!1,wt.waterMark=pt.waterMark||null,wt.waterMarkSize=pt.waterMarkSize||0,wt.waterMarkFontStyle=pt.waterMarkFontStyle||"Arial",wt.mosaicType=pt.mosaicType||null,wt.waterMarkColor=pt.waterMarkColor||"black",wt.borderColor=pt.borderColor||"red",wt.borderWidth=pt.borderWidth||1,wt.zoom=1,Z=0,ot.drawImage(lt,t,e,rt,dt,h,n,rt,dt),f(),a()}function a(){M(),o()}function o(){at.onclick=function(t){var e=z(t),i=e.x,a=e.y;i>at.width-30&&i<at.width&&a<at.height/2+60-vt&&a>at.height/2+30-vt&&h(),i>at.width-30&&i<at.width&&a<at.height/2+90-vt&&a>at.height/2+60-vt&&c(),i>at.width-30&&i<at.width&&a<at.height/2+120-vt&&a>at.height/2+90-vt&&g(),i>at.width-30&&i<at.width&&a<at.height/2+150-vt&&a>at.height/2+120-vt&&T(zt,Ct),i>0&&i<30&&a<at.height/2+60-vt&&a>at.height/2+30-vt&&n(),i>0&&i<30&&a<at.height/2+90-vt&&a>at.height/2+60-vt&&r(),i>0&&i<30&&a<at.height/2+120-vt&&a>at.height/2+90-vt&&d(),i>0&&i<30&&a<at.height/2+150-vt&&a>at.height/2+120-vt&&s(),i>0&&i<30&&a<at.height/2+180-vt&&a>at.height/2+150-vt&&l(),i>0&&i<30&&a<at.height/2+210-vt&&a>at.height/2+180-vt&&(w(),D=!0),i>0&&i<30&&a<at.height/2+240-vt&&a>at.height/2+210-vt&&p(),i>0&&i<30&&a<at.height/2+270-vt&&a>at.height/2+240-vt&&m(),i>0&&i<30&&a<at.height/2+300-vt&&a>at.height/2+270-vt&&(w(),E=!0),i>0&&i<30&&a<at.height/2+330-vt&&a>at.height/2+300-vt&&(w(),F=!0),i>0&&i<30&&a<at.height/2+360-vt&&a>at.height/2+330-vt&&(w(),U=!0),t.stopPropagation()}}function h(){it.clearRect(0,0,et.width,et.height),ot.clearRect(wt.left-1,wt.top-1,wt.width+2,wt.height+2),tt.style.display="none",et.style.display="block",wt={},dt=0,rt=0,Z=0,nt.clearRect(0,0,ht.width,ht.height)}function n(){++Z>3&&(Z=0);var t=90*Z*Math.PI/180,e=wt.left+wt.width/2,i=wt.top+wt.height/2,a=void 0,o=void 0;switch(ot.clearRect(wt.left-1,wt.top-1,wt.width+2,wt.height+2),Z){case 0:O=wt.height,wt.height=wt.width,wt.width=O,a=(at.width-wt.width)/2,o=(at.height-wt.height)/2,wt.left=a,wt.top=o,ot.save(),ot.translate(e,i),ot.rotate(t),wt.isVertical&&ot.scale(1,-1),wt.isHorizontal&&ot.scale(-1,1),ot.drawImage(lt,j,L,rt,dt,-wt.width/2,-wt.height/2,wt.width,wt.height),ot.restore();break;case 1:O=wt.height,wt.height=wt.width,wt.width=O,a=(at.width-wt.width)/2,o=(at.height-wt.height)/2,wt.left=a,wt.top=o,ot.save(),ot.translate(e,i),ot.rotate(t),wt.isVertical&&ot.scale(1,-1),wt.isHorizontal&&ot.scale(-1,1),ot.drawImage(lt,j,L,rt,dt,-wt.height/2,-wt.width/2,wt.height,wt.width),ot.restore();break;case 2:O=wt.height,wt.height=wt.width,wt.width=O,a=(at.width-wt.width)/2,o=(at.height-wt.height)/2,wt.left=a,wt.top=o,ot.save(),ot.translate(e,i),ot.rotate(t),wt.isVertical&&ot.scale(1,-1),wt.isHorizontal&&ot.scale(-1,1),ot.drawImage(lt,j,L,rt,dt,-wt.width/2,-wt.height/2,wt.width,wt.height),ot.restore();break;case 3:O=wt.height,wt.height=wt.width,wt.width=O,a=(at.width-wt.width)/2,o=(at.height-wt.height)/2,wt.left=a,wt.top=o,ot.save(),ot.translate(e,i),ot.rotate(t),wt.isVertical&&ot.scale(1,-1),wt.isHorizontal&&ot.scale(-1,1),ot.drawImage(lt,j,L,rt,dt,-wt.height/2,-wt.width/2,wt.height,wt.width),ot.restore()}wt.isMosaic&&y(),wt.isReverse&&I(),f(),nt.clearRect(0,0,ht.width,ht.height)}function r(){var t=wt.left+wt.width/2,e=wt.top+wt.height/2;--Z<0&&(Z=3);var i=90*Z*Math.PI/180,a=void 0,o=void 0;switch(ot.clearRect(wt.left-1,wt.top-1,wt.width+2,wt.height+2),Z){case 0:O=wt.height,wt.height=wt.width,wt.width=O,a=(at.width-wt.width)/2,o=(at.height-wt.height)/2,wt.left=a,wt.top=o,ot.save(),ot.translate(t,e),ot.rotate(i),wt.isVertical&&ot.scale(1,-1),wt.isHorizontal&&ot.scale(-1,1),ot.drawImage(lt,j,L,rt,dt,-wt.width/2,-wt.height/2,wt.width,wt.height),ot.restore();break;case 1:O=wt.height,wt.height=wt.width,wt.width=O,a=(at.width-wt.width)/2,o=(at.height-wt.height)/2,wt.left=a,wt.top=o,ot.save(),ot.translate(t,e),ot.rotate(i),wt.isVertical&&ot.scale(1,-1),wt.isHorizontal&&ot.scale(-1,1),ot.drawImage(lt,j,L,rt,dt,-wt.height/2,-wt.width/2,wt.height,wt.width),ot.restore();break;case 2:O=wt.height,wt.height=wt.width,wt.width=O,a=(at.width-wt.width)/2,o=(at.height-wt.height)/2,wt.left=a,wt.top=o,ot.save(),ot.translate(t,e),ot.rotate(i),wt.isVertical&&ot.scale(1,-1),wt.isHorizontal&&ot.scale(-1,1),ot.drawImage(lt,j,L,rt,dt,-wt.width/2,-wt.height/2,wt.width,wt.height),ot.restore();break;case 3:O=wt.height,wt.height=wt.width,wt.width=O,a=(at.width-wt.width)/2,o=(at.height-wt.height)/2,wt.left=a,wt.top=o,ot.save(),ot.translate(t,e),ot.rotate(i),wt.isVertical&&ot.scale(1,-1),wt.isHorizontal&&ot.scale(-1,1),ot.drawImage(lt,j,L,rt,dt,-wt.height/2,-wt.width/2,wt.height,wt.width),ot.restore()}wt.isMosaic&&y(),wt.isReverse&&I(),f(),nt.clearRect(0,0,ht.width,ht.height)}function d(){var t=wt.left+wt.width/2,e=wt.top+wt.height/2;ot.clearRect(wt.left-1,wt.top-1,wt.width+2,wt.height+2),wt.isVertical?(ot.save(),ot.translate(t,e),wt.isHorizontal&&ot.scale(-1,1),ot.rotate(90*Z*Math.PI/180),0!=Z&&2!=Z||ot.drawImage(lt,j,L,rt,dt,-wt.width/2,-wt.height/2,wt.width,wt.height),1!=Z&&3!=Z||ot.drawImage(lt,j,L,rt,dt,-wt.height/2,-wt.width/2,wt.height,wt.width),ot.restore(),wt.isVertical=!1):(ot.save(),ot.translate(t,e),ot.scale(1,-1),wt.isHorizontal&&ot.scale(-1,1),ot.rotate(90*Z*Math.PI/180),0!=Z&&2!=Z||ot.drawImage(lt,j,L,rt,dt,-wt.width/2,-wt.height/2,wt.width,wt.height),1!=Z&&3!=Z||ot.drawImage(lt,j,L,rt,dt,-wt.height/2,-wt.width/2,wt.height,wt.width),ot.restore(),wt.isVertical=!0),wt.isMosaic&&y(),wt.isReverse&&I(),f(),nt.clearRect(0,0,ht.width,ht.height)}function s(){var t=wt.left+wt.width/2,e=wt.top+wt.height/2;ot.clearRect(wt.left-1,wt.top-1,wt.width+2,wt.height+2),wt.isHorizontal?(ot.save(),ot.translate(t,e),wt.isVertical&&ot.scale(1,-1),ot.rotate(90*Z*Math.PI/180),0!=Z&&2!=Z||ot.drawImage(lt,j,L,rt,dt,-wt.width/2,-wt.height/2,wt.width,wt.height),1!=Z&&3!=Z||ot.drawImage(lt,j,L,rt,dt,-wt.height/2,-wt.width/2,wt.height,wt.width),ot.restore(),wt.isHorizontal=!1):(ot.save(),ot.translate(t,e),ot.scale(-1,1),wt.isVertical&&ot.scale(1,-1),ot.rotate(90*Z*Math.PI/180),0!=Z&&2!=Z||ot.drawImage(lt,j,L,rt,dt,-wt.width/2,-wt.height/2,wt.width,wt.height),1!=Z&&3!=Z||ot.drawImage(lt,j,L,rt,dt,-wt.height/2,-wt.width/2,wt.height,wt.width),ot.restore(),wt.isHorizontal=!0),wt.isMosaic&&y(),wt.isReverse&&I(),f(),nt.clearRect(0,0,ht.width,ht.height)}function l(){var t=wt.left+wt.width/2,e=wt.top+wt.height/2;wt.isMosaic?(ot.clearRect(wt.left-1,wt.top-1,wt.width+2,wt.height+2),ot.save(),ot.translate(t,e),ot.rotate(90*Z*Math.PI/180),wt.isVertical&&ot.scale(1,-1),wt.isHorizontal&&ot.scale(-1,1),ot.scale(wt.zoom,wt.zoom),0!=Z&&2!=Z||ot.drawImage(lt,j,L,rt,dt,-wt.width/wt.zoom/2,-wt.height/wt.zoom/2,wt.width/wt.zoom,wt.height/wt.zoom),1!=Z&&3!=Z||ot.drawImage(lt,j,L,rt,dt,-wt.height/wt.zoom/2,-wt.width/wt.zoom/2,wt.height/wt.zoom,wt.width/wt.zoom),ot.restore(),wt.isReverse&&I(),wt.isMosaic=!1):(y(),wt.isMosaic=!0),f(),nt.clearRect(0,0,ht.width,ht.height)}function c(){switch(ut){case"simple":t(ft).html(st),B=!1;break;case"normal":window.location.reload()}}function g(){var e=void 0,i=void 0;layer.prompt({title:"输入名字并选择一种格式",btn:["png","jpeg","cancle"],yes:function(a,o){e=t(o).find("input").val()||yt,i="png",layer.close(a),k(Ct(i),e+"."+i)},btn2:function(a,o){e=t(o).find("input").val()||yt,i="jpeg",layer.close(a),k(Ct(i),e+"."+i)},btn3:function(t,e){layer.close(t)},cancel:function(){}})}function w(){t("#pic").css("z-index",0),t("#paintCanvas").css("z-index",10),nt.clearRect(0,0,ht.width,ht.height)}function m(){ot.strokeStyle=wt.borderColor,ot.lineWidth=wt.borderWidth,ot.strokeRect(wt.left+1,wt.top+1,wt.width-2,wt.height-2)}function f(){wt.haveWaterMark&&(ot.font=wt.waterMarkSize+"px "+wt.waterMarkFontStyle,ot.strokeStyle=wt.waterMarkColor,ot.strokeText(wt.waterMark,wt.left,wt.top+wt.waterMarkSize))}function p(){var t=wt.left+wt.width/2,e=wt.top+wt.height/2;wt.isReverse?(ot.clearRect(wt.left-1,wt.top-1,wt.width+2,wt.height+2),ot.save(),ot.translate(t,e),ot.rotate(90*Z*Math.PI/180),wt.isVertical&&ot.scale(1,-1),wt.isHorizontal&&ot.scale(-1,1),ot.scale(wt.zoom,wt.zoom),0!=Z&&2!=Z||ot.drawImage(lt,j,L,rt,dt,-wt.width/wt.zoom/2,-wt.height/wt.zoom/2,wt.width/wt.zoom,wt.height/wt.zoom),1!=Z&&3!=Z||ot.drawImage(lt,j,L,rt,dt,-wt.height/wt.zoom/2,-wt.width/wt.zoom/2,wt.height/wt.zoom,wt.width/wt.zoom),ot.restore(),wt.isMosaic&&y(),wt.isReverse=!1):(I(),wt.isReverse=!0),f(),nt.clearRect(0,0,ht.width,ht.height)}function v(t,e,i,a){it.lineWidth=2,it.beginPath(),it.moveTo(t,e),it.lineTo(i,a),it.strokeStyle="white",it.stroke()}function u(t,e,i,a){nt.beginPath(),nt.moveTo(t,e),nt.lineTo(i,a),nt.stroke()}function z(t){var e=t||window.event;return{x:e.offsetX||e.layerX,y:e.offsetY||e.layerY}}function y(){for(var t=ot.getImageData(wt.left,wt.top,wt.width,wt.height),e=t.data,i=wt.width/50,a=wt.height/50,o=0;o<50;o++)for(var h=0;h<50;h++){var n=h*i+i/2,r=o*a+a/2,d=Math.floor(r)*(4*t.width)+4*Math.floor(n),s=e[d],l=e[d+1],c=e[d+2];ot.fillStyle="rgb("+s+","+l+","+c+")","circle"==wt.mosaicType?(ot.beginPath(),ot.arc(n+wt.left,r+wt.top,i/2.5,0,2*Math.PI,!1),ot.closePath(),ot.fill()):ot.fillRect(n-i/2+wt.left,r-a/2+wt.top,i,a)}}function I(){for(var t=ot.getImageData(wt.left,wt.top,wt.width,wt.height),e=t.data,i=0,a=e.length;i<a;i+=4)e[i]=255-e[i],e[i+1]=255-e[i+1],e[i+2]=255-e[i+2];ot.putImageData(t,wt.left,wt.top)}function k(e,i){var a=document.createElement("a");a.download=i,a.href=e,document.body.appendChild(a),a.click(),document.body.removeChild(a),t(a).remove()}function b(){var t=new Image;t.src=document.getElementById("paintCanvas").toDataURL(),t.onload=function(){ot.save(),ot.globalCompositeOperation="source-atop",ot.drawImage(t,0,0),ot.restore()}}function M(){var t=new Image,e=new Image,i=new Image,a=new Image,o=new Image,h=new Image,n=new Image,r=new Image,d=new Image,s=new Image,l=new Image,c=new Image,g=new Image,w=new Image,m=new Image;t.src="../img/close.png",t.onload=function(){ot.drawImage(t,at.width-30,at.height/2-vt+30,30,30)},h.src="../img/back.png",h.onload=function(){ot.drawImage(h,at.width-30,at.height/2+30-vt+30,30,30)},r.src="../img/download.png",r.onload=function(){ot.drawImage(r,at.width-30,at.height/2+60-vt+30,30,30)},c.src="../img/upload.png",c.onload=function(){ot.drawImage(c,at.width-30,at.height/2+90-vt+30,30,30)},e.src="../img/rotateRight.png",e.onload=function(){ot.drawImage(e,0,at.height/2+30-vt,30,30)},i.src="../img/rotateLeft.png",i.onload=function(){ot.drawImage(i,0,at.height/2+60-vt,30,30)},a.src="../img/upDown.png",a.onload=function(){ot.drawImage(a,0,at.height/2+90-vt,30,30)},o.src="../img/leftRight.png",o.onload=function(){ot.drawImage(o,0,at.height/2+120-vt,30,30)},n.src="../img/mosaic.png",n.onload=function(){ot.drawImage(n,0,at.height/2+150-vt,30,30)},d.src="../img/paint.png",d.onload=function(){ot.drawImage(d,0,at.height/2+180-vt,30,30)},s.src="../img/reverse.png",s.onload=function(){ot.drawImage(s,0,at.height/2+210-vt,30,30)},l.src="../img/boder.png",l.onload=function(){ot.drawImage(l,0,at.height/2+240-vt,30,30)},g.src="../img/addRect.png",g.onload=function(){ot.drawImage(g,0,at.height/2+270-vt,30,30)},w.src="../img/addCircle.png",w.onload=function(){ot.drawImage(w,0,at.height/2+300-vt,30,30)},m.src="../img/input.png",m.onload=function(){ot.drawImage(m,0,at.height/2+330-vt,30,30)}}function C(){$=document.getElementsByClassName("backGround")[0],tt=document.getElementsByClassName("mask")[0],et=document.getElementById("myCanvas"),"function"==typeof et.getContext&&(it=et.getContext("2d")),at=document.getElementById("pic"),"function"==typeof at.getContext&&(ot=at.getContext("2d")),ht=document.getElementById("paintCanvas"),"function"==typeof ht.getContext&&(nt=ht.getContext("2d"))}function R(){et.onmousedown=function(t){t=t||window.event,W=!0;var e=z(t);j=e.x,L=e.y},et.onmousemove=function(t){if(t=t||window.event,W){var e=z(t);it.clearRect(0,0,et.width,et.height),V=!0,N=e.x,A=e.y,v(j,L,N,L),v(j,L,j,A),v(N,A,N,L),v(N,A,j,A)}},et.onmouseup=function(){W&&V&&(it.clearRect(0,0,et.width,et.height),j>N&&(O=j,j=N,N=O),L>A&&(O=L,L=A,A=O),i(j,L,N,A)),W=!1,V=!1},ht.onmousedown=function(t){var e=z(t),i=e.x,a=e.y;i>wt.left&&i<wt.left+wt.width&&a>wt.top&&a<wt.top+wt.height&&(nt.lineWidth=mt.paintWidth,nt.strokeStyle=mt.paintColor,W=!0,Y=i,G=a,D&&(nt.beginPath(),nt.moveTo(i,a)))},ht.onmousemove=function(t){var e=z(t),i=e.x,a=e.y;i>wt.left&&i<wt.left+wt.width&&a>wt.top&&a<wt.top+wt.height&&(D&&W&&(nt.lineTo(i,a),nt.stroke()),E&&W&&(J=i,X=a,nt.clearRect(0,0,ht.width,ht.height),u(Y,G,J,G),u(Y,G,Y,X),u(J,X,J,G),u(J,X,Y,X)),F&&W&&(J=i,X=a,Q=Y<J?Y:J,_=Y<J?J:Y,q=G<X?G:X,K=G<X?X:G,nt.clearRect(0,0,ht.width,ht.height),nt.ellipse?(nt.beginPath(),nt.ellipse((Q+_)/2,(K+q)/2,(_-Q)/2,(K-q)/2,0,0,2*Math.PI),nt.stroke()):P(nt,Q,q,_-Q,K-q)))},ht.onmouseup=function(e){var i=z(e),a=i.x,o=i.y;a>wt.left&&a<wt.left+wt.width&&o>wt.top&&o<wt.top+wt.height&&(D&&W&&(nt.closePath(),D=!1,t("#pic").css("z-index",10),t("#paintCanvas").css("z-index",0),b()),E&&W&&(E=!1,t("#pic").css("z-index",10),t("#paintCanvas").css("z-index",0),b()),F&&W&&(F=!1,t("#pic").css("z-index",10),t("#paintCanvas").css("z-index",0),b()),U&&(It=new CanvasInput({canvas:ht,fontSize:18,fontFamily:"Arial",placeHolder:"Type...",borderWidth:0,boxShadow:"none",x:a,y:o,onsubmit:function(){H()}}),It.focus(),U=!1)),W=!1,nt.clearRect(0,0,ht.width,ht.height)}}function x(){at.addEventListener("wheel",function(t){var e=wt.left+wt.width/2,i=wt.top+wt.height/2,a=z(t);if(a.x>wt.left&&a.x<wt.left+wt.width&&a.y>wt.top&&a.y<wt.top+wt.height){if(t.preventDefault(),120==t.wheelDelta||3==t.wheelDelta){var o=(at.width-wt.width*(1/.9))/2,h=(at.width-wt.height*(1/.9))/2;if(o<30||h<30)return;ot.clearRect(wt.left-1,wt.top-1,wt.width+2,wt.height+2),ot.save(),ot.translate(e,i),ot.rotate(90*Z*Math.PI/180),wt.isVertical&&ot.scale(1,-1),wt.isHorizontal&&ot.scale(-1,1),wt.zoom=wt.zoom*(1/.9),wt.width=wt.width*(1/.9),wt.height=wt.height*(1/.9);var n=(at.width-wt.width)/2,r=(at.height-wt.height)/2;wt.left=n,wt.top=r,ot.scale(wt.zoom,wt.zoom),0!=Z&&2!=Z||ot.drawImage(lt,j,L,rt,dt,-wt.width/wt.zoom/2,-wt.height/wt.zoom/2,wt.width/wt.zoom,wt.height/wt.zoom),1!=Z&&3!=Z||ot.drawImage(lt,j,L,rt,dt,-wt.height/wt.zoom/2,-wt.width/wt.zoom/2,wt.height/wt.zoom,wt.width/wt.zoom),ot.restore()}if(-120==t.wheelDelta||-3==t.wheelDelta){ot.clearRect(wt.left-1,wt.top-1,wt.width+2,wt.height+2),ot.save(),ot.translate(e,i),ot.rotate(90*Z*Math.PI/180),wt.isVertical&&ot.scale(1,-1),wt.isHorizontal&&ot.scale(-1,1),wt.zoom=.9*wt.zoom,wt.width=.9*wt.width,wt.height=.9*wt.height;var d=(at.width-wt.width)/2,s=(at.height-wt.height)/2;wt.left=d,wt.top=s,ot.scale(wt.zoom,wt.zoom),0!=Z&&2!=Z||ot.drawImage(lt,j,L,rt,dt,-wt.width/wt.zoom/2,-wt.height/wt.zoom/2,wt.width/wt.zoom,wt.height/wt.zoom),1!=Z&&3!=Z||ot.drawImage(lt,j,L,rt,dt,-wt.height/wt.zoom/2,-wt.width/wt.zoom/2,wt.height/wt.zoom,wt.width/wt.zoom),ot.restore()}wt.isMosaic&&y(),wt.isReverse&&I(),f(),nt.clearRect(0,0,ht.width,ht.height)}})}function P(t,e,i,a,o){var h=a/2*.5522848,n=o/2*.5522848,r=e+a,d=i+o,s=e+a/2,l=i+o/2;t.beginPath(),t.moveTo(e,l),t.bezierCurveTo(e,l-n,s-h,i,s,i),t.bezierCurveTo(s+h,i,r,l-n,r,l),t.bezierCurveTo(r,l+n,s+h,d,s,d),t.bezierCurveTo(s-h,d,e,l+n,e,l),t.stroke()}function T(t,e){var i=void 0;layer.open({title:"选择格式",btn:["png","jpeg","cancle"],yes:function(a,o){i="png",layer.close(a),t(i,e)},btn2:function(a,o){i="jpeg",layer.close(a),t(i,e)},btn3:function(t,e){layer.close(t)},cancel:function(){}})}function S(e,i){t.post("uploadCutPic",{info:i(e),picType:e},function(e){layer.open({btn:"去下载!",title:"Your UUID",content:e,yes:function(e,i){t("body").append('<a href="" id="goto" target="_blank"></a>'),t("#goto").attr("href","findPicByUUID"),t("#goto").get(0).click(),t("#goto").remove(),layer.close(e)}})})}function H(){nt.clearRect(0,0,ht.width,ht.height),t("#pic").css("z-index",10),t("#paintCanvas").css("z-index",0),ot.font=It.fontSize()+"px "+It.fontFamily(),ot.strokeStyle=It.fontColor(),ot.strokeText(It.value(),It.x(),It.y()+It.fontSize()),It.destroy()}e=t.extend({haveWaterMark:!1,waterMark:"",waterMarkSize:12,waterMarkColor:"green",waterMarkFontStyle:"Arial",paintColor:"red",paintWidth:2,reloadWay:"normal",borderColor:"red",borderWidth:2,downloadType:"png",downloadName:"cutPic",uploadFunc:"nodeJs"},e);var W=!1,V=!1,D=!1,E=!1,F=!1,B=!1,U=!1,j=void 0,L=void 0,N=void 0,A=void 0,Y=void 0,G=void 0,J=void 0,X=void 0,O=void 0,Q=void 0,_=void 0,q=void 0,K=void 0,Z=0,$=void 0,tt=void 0,et=void 0,it=void 0,at=void 0,ot=void 0,ht=void 0,nt=void 0,rt=void 0,dt=void 0,st=void 0,lt=new Image,ct=void 0,gt=void 0,wt={width:0,height:0,left:0,top:0,zoom:1,isVertical:!1,isHorizontal:!1,haveWaterMark:!1,waterMark:null,waterMarkSize:0,waterMarkFontStyle:null,waterMarkColor:null,isMosaic:!1,mosaicType:null,isReverse:!1,borderColor:null,borderWidth:1},mt={paintColor:"red",paintWidth:2,width:0,height:0,left:0,top:0,zoom:1,isVertical:!1,isHorizontal:!1},ft=void 0,pt=void 0,vt=150,ut="simple",zt=null,yt=void 0,It=void 0,kt=this;if(pt=e,"function"!=typeof(zt=e.uploadFunc||function(){alert("you have not define a func")}))switch(zt){case"nodeJS":zt=S;break;default:zt=function(){layer.open({content:"没有找到对应上传方法"})}}pt.downloadType,yt=pt.downloadName||"cutPic",ft=this.get(0),mt.paintColor=pt.paintColor||"red",mt.paintWidth=pt.paintWidth||2,ut=pt.reloadWay||"simple",ft.onclick=function(e){B||(B=!B,html2canvas(ft,{allowTaint:!0,taintTest:!1,background:"#ffffff",onrendered:function(e){ct=t(ft).width(),gt=t(ft).height(),st=t(ft).html(),t(ft).empty(),bt(e),Mt()}}))};var bt=function(e){lt.src=e.toDataURL();var i=ct,a=gt,o=t("<div class=backGround></div>");o.css("background-image","url("+lt.src+")"),o.css("position","relative"),o.height(a).width(i);var h=t("<canvas id=paintCanvas>your browser doesn't support canvas!</canvas>");h.css("position","absolute").css("top",0).css("left",0).css("z-index",0),h.attr("height",a).attr("width",i);var n=t("<canvas id=pic>your browser doesn't support canvas!</canvas>");n.css("position","absolute").css("top",0).css("left",0).css("z-index",10),n.attr("height",a).attr("width",i);var r=t("<div class=mask></div>");r.css("position","relative").css("display","none").css("top",0).css("left",0).css("background-color","rgba(0,0,0,0.8)"),r.height(a).width(i),r.append(n).append(h);var d=t("<canvas id=myCanvas>your browser doesn't support canvas!</canvas>");d.css("position","relative").css("cursor","crosshair").css("top",0).css("left",0),d.attr("height",a).attr("width",i),o.append(r).append(d),t(ft).append(o)},Mt=function(){C(),R(),x()},Ct=function(t){var e=ot.getImageData(wt.left,wt.top,wt.width,wt.height),i=document.createElement("canvas");return i.width=wt.width,i.height=wt.height,i.getContext("2d").putImageData(e,0,0),i.toDataURL("image/"+t,1)};return kt}}(jQuery);